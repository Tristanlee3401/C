CC = gcc
CFLAGS = -Wall -g -lgmp
TARGET = ipv4-ipv6-calc
SRC = ipv4-ipv6-calc.c
OBJ = $(SRC:.c=.o)

all: $(TARGET)

$(TARGET): $(OBJ)
	$(CC) $(OBJ) -o $(TARGET) $(CFLAGS)

%.o: %.c
	$(CC) $(CFLAGS) -c $< -o $@

clean:
	rm -f $(TARGET) $(OBJ)

test: $(TARGET)
	@echo "Running tests..."
	@echo "=== IPv4 Tests ==="
	./$(TARGET) 192.168.1.100 /24
	@echo "------------------------"
	./$(TARGET) -b 192.168.1.100 255.255.255.0
	@echo "------------------------"
	./$(TARGET) 11000000.10101000.00000001.01100100 /24
	@echo "------------------------"
	./$(TARGET) -b 0xc0a80d17 0xffff0000
	@echo "------------------------"
	@echo "=== Valid IPv6 Subnet Tests ==="
	./$(TARGET) 2001:db8::1 /64
	@echo "------------------------"
	./$(TARGET) -b 2001:db8::1 /48
	@echo "------------------------"
	./$(TARGET) ::1 /128
	@echo "------------------------"
	./$(TARGET) 2001:0db8:0000:0000:0000:0000:0000:0001 ffff:ffff:ffff::0
	@echo "------------------------"
	./$(TARGET) :: /128
	@echo "------------------------"
	./$(TARGET) 0x20010db8000000000000000000000001 /64
	@echo "------------------------"
	./$(TARGET) fe80::1%eth0 /10
	@echo "------------------------"
	./$(TARGET) 00100000000000010000110110111000.0000000000000000.0000000000000000.0000000000000000.0000000000000000.0000000000000000.0000000000000000.0000000000000001 11111111111111111111111111111111.1111111111111111.0000000000000000.0000000000000000.0000000000000000.0000000000000000.0000000000000000.0000000000000000
	@echo "------------------------"
	./$(TARGET) -b ::ffff:192.168.1.1 /112
	@echo "------------------------"
	./$(TARGET) ff02::1 /8
	@echo "------------------------"
	./$(TARGET) fc00::1 /7
	@echo "------------------------"
	@echo "=== Invalid IPv4/IPv6 Tests ==="
	./$(TARGET) 2001:db8::1 /129
	@echo "------------------------"
	./$(TARGET) 2001:db8::1 /abc
	@echo "------------------------"
	./$(TARGET) 2001:db8::1 ffff:0:0:ffff::
	@echo "------------------------"
	./$(TARGET) 2001:db8::1 255.255.255.0
	@echo "------------------------"
	./$(TARGET) 2001:db8::1 2001:db8:::1
	@echo "------------------------"
	./$(TARGET) 2001:db8::1 11111111111111110000000000000000
	@echo "------------------------"
	./$(TARGET) ""
	@echo "------------------------"
	./$(TARGET) 192.168.1.100 0xff00ff00
	@echo "------------------------"
	./$(TARGET) 256.256.256.256 /24
	@echo "------------------------"
	./$(TARGET) 0xgggggg

.PHONY: all clean test
